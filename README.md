# Тестовое задание

## Условие

**Задача**: Сделать простой сервер, который принимает изображение и отправляет его в бесплатный сервис модерации, чтобы понять — есть ли на нём нежелательный контент.

**Что нужно сделать**: Написать `backend`-приложение на `Python` (лучше `FastAPI`, можно `Flask`)

**Создать эндпоинт**:

- `POST /moderate`
- Принимает изображение (`.jpg`, `.png`)
- Отправляет его в [DeepAI NSFW API](https://deepai.org/machine-learning-model/nsfw-detector) - либо найти аналогичный.

**Возвращает результат**:

- `{"status": "OK"}` — если безопасно
- `{"status": "REJECTED", "reason": "NSFW content"}` — если найден неприемлемый контент

Технические детали: API DeepAI: бесплатный, после регистрации даётся ключ

**Условия**:

- Если `nsfw_score` > 0.7 → `REJECTED`
- Иначе → `OK`

**Для проверки задания отправь нам**:

- `GitHub`-ссылку
- `README.md` с Инструкцией по запуску и Примером запроса (`curl` или `Postman`)
- `requirements.txt`

**Пример запроса**:

`curl -X POST -F "file=@example.jpg" http://localhost:8000/moderate`

## Разъяснения по ТЗ

> [!IMPORTANT]
> Не было найдено бесплатных аналогов, которые позволяют проверять `NSFW` контент.
> Есть доступные аналоги с дешевой ценой, но большинство из них не поддерживает загрузки файлов, напрямую, только через публичные `URL`.

> [!IMPORTANT]
> Предоставленный `API` в тз на данный момент уже не существует, на сайте нет упоминания, что есть поддержка.
> По переходу по ссылке из ТЗ кидает просто на главный экран сайта, тем самым данного функционала уже нет просто.
> В списке поддерживаемых тоже не было обнаружено `NSFW detection`. 

![изображение](https://github.com/user-attachments/assets/37886139-e806-407b-af22-6da73ae2749d)

> Автор решил использовать `https://gen-api.ru/model/image-nsfw-checker/api`, но из-за багов на стороне `API` была добавлена поддержка своей сети с использованием библиотеки.
> Если не хотите использовать собственную сеть, то из `pyproject.toml` нужно удалить `"nsfw-image-detector>=0.1.2"`, удалить класс и заменить в `IoC container` на класс с `API`.

> На фотографии представлен ответ от тех. поддержки, в моем случае `sync` режим не работал для проверки. По ТЗ требуется сделать только `sync` ручку, которая будет ожидать ответа от стороннего сервиса.
> В итоге, единственное решение - это использовать свою нейронную сеть. 

![изображение](https://github.com/user-attachments/assets/7dbb21a6-8622-4cc9-bd8f-44c63b6cf912)

## Тестирование

> [!IMPORTANT]
> К сожалению, фотографии прикрепить нет возможности из-за нехватки ресурсов для запуска приложения.
> Здесь оформлена архитектура и рабочий прототип, но из-за нехватки мощности нет возможности продемонстрировать примеры запросов.

## Основные технологии (фреймворки и библиотеки)

- `FastAPI`
- `Dishka`
- `uv`
- `redis`

## Принцип архитектуры

Для создания сервиса использовался подход `Clean Architecture`. 
Каждый слой разделен на независимые части, где все взаимодействие происходит через интерфейсы. 
Более подробно можете ознакомиться по [ссылке на видео](https://youtu.be/2dKZ-dWaCiU?si=WjN6S2z4D3kcLBue)

## Запуск

Создайте файл `.env`, скопировав значения из `.env.dist`. 
Дальше выполните команду, которая представлена ниже: 

```bash
docker compose up --build
```
